# ADR 0002: Шарова архітектура бекенду

- Статус: Accepted
- Дата: 2025-12-02

## Контекст

Бекенд розгорнуто у папці `backend/` і використовує Node.js + Express. У попередніх практичних уже виділено доменні моделі в папці `domain/`.

Потрібно зафіксувати мінімальну шарову структуру та правила залежностей.

## Рішення

У бекенді запроваджуються такі шари:

- `backend/api/`

  - HTTP-рівень: Express-роути та контролери.
  - Приймає HTTP-запити, мапить їх на DTO, викликає відповідні сервіси.
  - Формує HTTP-відповіді згідно з контрактом OpenAPI.

- `backend/service/`

  - Рівень use-case / application service.
  - Містить бізнес-логіку сценаріїв, валідацію вхідних даних, обробку помилок.
  - Взаємодіє з інфраструктурою (БД) та, за потреби, з доменними моделями з `domain/`.

- `domain/`
  - Доменні моделі та інваріанти (наприклад, `Item`, `Order`, `User`).
  - Не залежать від Express, HTTP чи конкретної бази даних.

## Напрямок залежностей

- `backend/api` може залежати від:

  - `backend/service`
  - DTO-схем (описаних у документації).

- `backend/service` може залежати від:

  - `domain`
  - інфраструктурних модулів (наприклад, `backend/db.js`).

- `domain` не залежить від `api` та `service`.

## Заборонені звʼязки

- `backend/api` не звертається напряму до `backend/db.js` чи інших інфраструктурних модулів.
- `domain` не використовує Express, HTTP-обʼєкти, конкретні DTO чи структури відповідей.
- Обхід сервісів (наприклад, прямий виклик `domain` із `api`) не допускається для бізнес-сценаріїв.

## Наслідки

- Код легше тестувати на рівні `service`, ізольовано від HTTP.
- Доменні моделі залишаються незалежними від інфраструктури.
- У майбутньому можливий перехід до окремих сервісів з мінімальними змінами в домені.
